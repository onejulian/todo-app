<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Todo List App</title>
    
    <!-- Script inline para aplicar la clase 'dark' antes de cargar Tailwind CSS -->
    <script>
        (function() {
            try {
                const mode = localStorage.getItem('mode');
                if (mode === 'dark') {
                    document.documentElement.classList.add('dark');
                } else if (mode === 'light') {
                    document.documentElement.classList.remove('dark');
                }
                // Si no hay modo almacenado, puedes optar por detectar el modo del sistema
                // else {
                //     if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
                //         document.documentElement.classList.add('dark');
                //     }
                // }
            } catch (e) {
                console.error('Error al acceder a localStorage:', e);
            }
        })();
    </script>

    <!-- Cargar Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    // Personalizaciones adicionales aquí
                },
            },
        }
    </script>
    
    <!-- Cargar Font Awesome -->
    <script src="https://kit.fontawesome.com/64d58efce2.js" crossorigin="anonymous"></script>
    
    <!-- Estilos personalizados -->
    <style>
        /* Ocultar la barra de desplazamiento en navegadores WebKit */
        #todoList::-webkit-scrollbar {
            display: none;
        }

        /* Ocultar la barra de desplazamiento en Firefox */
        #todoList {
            scrollbar-width: none; /* Firefox */
        }

        /* Transición suave para cambios de color */
        html {
            transition: background-color 0.3s, color 0.3s;
        }
    </style>
</head>
<body class="bg-white text-gray-900 dark:bg-gray-900 dark:text-white flex flex-col items-center min-h-screen transition-colors duration-300">
    <header class="bg-gray-200 w-full p-4 text-center dark:bg-gray-800 dark:text-white">
        <div class="flex justify-between items-center">
            <h1 class="text-3xl font-bold">Todo List App</h1>
            <button id="toggleMode" class="bg-gray-300 text-gray-900 p-2 rounded hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white">
                <i id="modeIcon" class="fas fa-moon text-lg"></i>
            </button>
        </div>
    </header>
    <main class="flex items-center justify-center flex-grow w-full px-4 sm:px-6 lg:px-8">
        <div class="bg-gray-100 p-6 rounded-lg shadow-md w-full max-w-md dark:bg-gray-800 dark:text-white">
            <input 
                type="text" 
                id="todoInput" 
                placeholder="Añadir una nueva tarea" 
                class="w-full p-3 mb-4 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900 dark:text-white dark:bg-gray-700 text-lg"
            >
            <button 
                id="addButton" 
                class="w-full bg-blue-500 text-white py-3 rounded hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 text-lg"
            >
                Añadir Tarea
            </button>
            <ul id="todoList" class="mt-6 space-y-3 max-h-[300px] overflow-y-auto">
                <!-- Las tareas se agregarán aquí -->
            </ul>
        </div>
    </main>

    <script>
        // Función para actualizar el ícono del modo
        function updateModeIcon() {
            const icon = document.getElementById('modeIcon');
            if (document.documentElement.classList.contains('dark')) {
                icon.className = 'fas fa-sun text-lg';
            } else {
                icon.className = 'fas fa-moon text-lg';
            }
        }

        // Función para guardar el estado en localStorage
        function saveState() {
            const tasks = Array.from(document.querySelectorAll('.task-text')).map(span => span.textContent);
            localStorage.setItem('tasks', JSON.stringify(tasks));

            // Guardar el modo actual
            const mode = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
            localStorage.setItem('mode', mode);
        }

        // Función para cargar el estado desde localStorage
        function loadState() {
            const tasks = JSON.parse(localStorage.getItem('tasks')) || [];
            tasks.forEach(taskText => addTask(taskText));

            // El modo ya se aplica en el script inline al cargar la página
            updateModeIcon();
        }

        // Función para añadir una tarea
        function addTask(taskText) {
            const li = document.createElement('li');
            // Añadimos la clase 'group' para manejar el hover en Tailwind CSS
            li.className = 'group flex items-center justify-between p-3 bg-gray-200 rounded dark:bg-gray-700 dark:text-white transition-colors duration-300';
            li.innerHTML = `
                <span class="task-text text-lg">${taskText}</span>
                <div class="opacity-100 sm:opacity-0 group-hover:opacity-100 focus-within:opacity-100 transition-opacity duration-200 flex space-x-2">
                    <button class="edit-button text-blue-500 hover:text-blue-600 focus:outline-none"><i class="fas fa-pencil-alt text-lg"></i></button>
                    <button class="delete-button text-red-500 hover:text-red-600 focus:outline-none"><i class="fas fa-trash text-lg"></i></button>
                </div>
            `;
            document.getElementById('todoList').appendChild(li);

            // Evento para editar una tarea
            li.querySelector('.edit-button').addEventListener('click', function() {
                const span = li.querySelector('.task-text');
                const input = document.createElement('input');
                input.type = 'text';
                input.value = span.textContent;
                input.className = 'w-full p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900 dark:text-white dark:bg-gray-700 text-lg';
                span.replaceWith(input);
                input.focus();

                input.addEventListener('blur', function() {
                    const nuevoTexto = input.value.trim();
                    if (nuevoTexto) {
                        const newSpan = document.createElement('span');
                        newSpan.className = 'task-text text-lg';
                        newSpan.textContent = nuevoTexto;
                        input.replaceWith(newSpan);
                        saveState();
                    } else {
                        // Si el texto está vacío, eliminar la tarea
                        li.remove();
                        saveState();
                    }
                });
            });

            // Evento para eliminar una tarea con confirmación
            li.querySelector('.delete-button').addEventListener('click', function(event) {
                event.stopPropagation(); // Evita que el click propague al documento

                if (!li.classList.contains('deleting')) {
                    // Marcar la tarea para eliminación
                    li.classList.add('deleting', 'bg-red-500', 'dark:bg-red-700');

                    // Ocultar el botón de editar
                    const editButton = li.querySelector('.edit-button');
                    if (editButton) {
                        editButton.style.display = 'none';
                    }

                    // Cambiar el icono del botón de eliminar para indicar confirmación
                    const deleteIcon = li.querySelector('.delete-button i');
                    deleteIcon.classList.remove('fa-trash');
                    deleteIcon.classList.add('fa-times');

                    // Cambiar el color del botón de eliminar a blanco con efecto hover más claro
                    const deleteButton = li.querySelector('.delete-button');
                    deleteButton.classList.remove('text-red-500', 'hover:text-red-600');
                    deleteButton.classList.add('text-white', 'hover:text-gray-300');

                    // Agregar una referencia al listener para poder eliminarlo después
                    const cancelDeletion = function(e) {
                        if (!li.contains(e.target)) {
                            // Cancelar la eliminación
                            li.classList.remove('deleting', 'bg-red-500', 'dark:bg-red-700');

                            // Mostrar nuevamente el botón de editar
                            if (editButton) {
                                editButton.style.display = 'inline-block';
                            }

                            // Cambiar el icono del botón de eliminar de vuelta a la papelera
                            deleteIcon.classList.remove('fa-times');
                            deleteIcon.classList.add('fa-trash');

                            // Restaurar el color original del botón de eliminar
                            deleteButton.classList.remove('text-white', 'hover:text-gray-300');
                            deleteButton.classList.add('text-red-500', 'hover:text-red-600');

                            // Remover el listener de cancelación
                            document.removeEventListener('click', cancelDeletion);
                        }
                    };

                    // Agregar el listener para cancelar la eliminación al hacer clic fuera
                    document.addEventListener('click', cancelDeletion);
                } else {
                    // Confirmar y eliminar la tarea definitivamente
                    li.remove();
                    saveState();
                }
            });

            saveState();
        }

        // Evento para alternar el modo claro/oscuro
        document.getElementById('toggleMode').addEventListener('click', function() {
            document.documentElement.classList.toggle('dark');
            updateModeIcon();
            saveState();
        });

        // Evento para añadir una tarea al hacer clic en el botón
        document.getElementById('addButton').addEventListener('click', function() {
            const input = document.getElementById('todoInput');
            const taskText = input.value.trim();
            if (taskText) {
                addTask(taskText);
                input.value = '';
            }
        });

        // Cargar el estado al cargar la página
        window.addEventListener('DOMContentLoaded', loadState);
    </script>
</body>
</html>
